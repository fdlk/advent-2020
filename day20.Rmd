---
title: "--- Day 20: Jurassic Jigsaw ---"
author: Fleur Kelpin
date: Dec 20, 2020
output: github_document
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
options(digits=22)
input <- read_file("day20.txt") %>%
  str_split("\\n\\n") %>%
  unlist() %>%
  {tibble(line=.)} %>%
  extract(line, c("id", "tile", NA), "Tile (\\d+):\\n((.|\\n)*)$", convert = T) %>%
  mutate(num=row_number())
input
```
```{r}
n <- 10
tiles <- array(FALSE, dim=c(n, n,nrow(input)))
for(i in 1:nrow(input)){
  tiles[,,i] <- input$tile[[i]] %>%
    str_split("\n") %>%
    unlist() %>%
    map(~ str_split(., "")) %>%
    unlist() %>%
    map_lgl(~ . == "#") %>%
    matrix(nrow=n, byrow=T)
}
tiles[,,1]
```
```{r}
edges <- function(x) {
  c(tiles[1,,x],
    tiles[,1,x],
    tiles[10,,x],
    tiles[,10,x],
    tiles[1,10:1,x],
    tiles[10:1,1,x],
    tiles[10,10:1,x],
    tiles[10:1,10,x]) %>%
  matrix(ncol=n, byrow=T)
}
edges(2)
```

```{r}
matches <- function(i,j) {
  matrix(t(c(t(edges(i)),t(edges(j)))), ncol=n, byrow=T) %>%
    duplicated() %>%
    any()
}
num_matches <- function(i) {
  result <- 0
  for(j in 1:nrow(input)) {
    if(j != i && matches(i,j)){
      result <- result + 1
    }
  }
  result
}
input %>%
  rowwise() %>%
  mutate(matches = num_matches(num)) %>%
  filter(matches == 2) %>%
  ungroup() %>%
  summarise(prod(id))
```